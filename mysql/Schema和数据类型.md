# Schema和数据类型

### 选择数据类型的原则

* 更小的通常更好：更小的数据类型通常更快，占据很少的磁盘、内存和CPU缓存，处理时需要的CPU周期也更少。
* 简单就好：简单数据类型的操作通常需要更少的CPU周期。
* 尽量避免NULL：查询中包含NULL的列，使得索引、索引统计和值比较更复杂。可为NULL的列被索引时，需要额外的1个字节存储。

------

### 整数类型

```
TINYINT(8 bit)
SMALLINT(16 bit) 
MEDUIMINT(24 bit)
INT(32 bit)
BIGINT(64 bit)
```

* 有可选的UNSIGNED属性，表示不允许为负值。
* 有符号和无符号类型使用相同的存储空间，并具有相同的性能。
* INT(11)一般来说没有意义，只是规定了MySQL的一些交互工具用来显示字符的个数。

------

### 实数类型

```
FLOAT(4 bytes)
DOUBLE(8 bytes)
DECIMAL
```

* FLOAT和DOUBLE支持使用标准的浮点运算进行近似计算。
* DECIMAL用于存储精确的小数，可以指定小数点前后所允许的最大位数。
* DECIMAL(18, 9)小数点两边各存储9个数字，一共9个字节。小数点左边4个，小数点后面4个，小数点本身1个字节。
* MySQL5.0以上版本DECIMAL类型允许最多65个数字。
* 数据量较大时，可以采用BIGINT代替DECIMAL，避免了浮点的不精确和DECIMAL精确代价高得问题。

------

### 字符串类型

```
VARCHAR
CHAR
BLOB
TEXT
```

* 存储引擎存储CHAR或者VARCHAR值的方式在内存中和磁盘中不一样，所以从存储引擎中读出的值需要转换格式。
* VARCHAR用于存储可变长字符串，比定长更节省空间。如果ROW_FORMAT=FIXED创建的话，就是定长的。
* VARCHAR需要额外的1或2字节记录字符串长度。在MySQL5.0以上版本，检索和存储时会保留末尾空格。
* VARCHAR节省了存储空间，对性能也有帮助。如果UPDATE时页内没有额外空间就需要也分裂。
* InnoDB会把过长的VARCHAR保存为BLOB。
* CHAR类型会删除所有的末尾空格，并且以空格填充至指定长度。
* VARCHAR(5)和VARCHAR(200)，在需要用到内存临时表时，200会分配更多的空间。
* BLOB和TEXT分别用二进制和字符串方式存储，MySQL吧每个BLOB和TEXT当作独立的对象处理。
* 如果BLOB和TEXT太大时，每个值在行内需要1~4字节的指针，值存储在外部存储区域。

------

### 枚举（ENMUM）

* 枚举列可以把一些不重复的字符串存储成一个预定的集合。
* MySQL会把会根据列表值得数量压缩到一个字节和两个字节中。

------

### 日期和时间

```
TIMESTAMP(4 bytes)
DATETIME(8 bytes)
```

* DATETIME保存10001~9999年，精度为秒。把日期和时间封装到YYYYMMDDHHMMSS的整数中。
* TIMESTAMP保存了1970年~2038年，和UNIX时间戳相同。
* 用整数保存时间截的格式通常不方便处理。

------

### 位数据类型

* BIT(1)包含一个位的字段，最大长度64个位。
* InnoDB为每个BIT列使用一个足够存储的最小整数来存放。

------

### 特殊类型

```
INET_ATON()
INET_NTOA()
```

* 使用32位无符号整数存储IP地址

------

### Schema设计中的缺陷

* 太多的列：MySQL的存储引擎API工作时需要在服务器层和存储引擎层之间通过行缓冲格式拷贝数据，然后在服务器层将缓冲内容解码成各个列。MyISAM的定长结构不需要转换，MyISAM变长和InnoDB行结构则总是需要转换的。如果使用了宽表，CPU的压力就会特别大。
