# 执行计划

> 1. 根据搜索条件，找出所有可能使用的索引
> 2. 计算全表扫描的代价
> 3. 计算使用不同所以执行查询的代价
> 4. 对比各种执行方案代价，找出成本最低的那个方案

### MySQL执行成本

> 读取一个页面花费的成本默认是1.0。
>
> 读取以及检测一条记录是否符合搜索条件的成本是0.2。
>
> 在读取记录时，即使不需要检测记录是否符合搜索条件，其成本也算0.2。

***I/O成本***

当查询表中的记录时，需要先把数据或者索引加载到内存中，然后再进行操作。这个从磁盘到内存的加载过程损耗时间称为I/O成本。

***CPU成本***

读取记录以及检测记录是否满足对应的搜索条件、对结果集进行排序等这些操作消耗的时间称为CPU成本

------

### 全表扫描的代价

> SHOW TABLE STATUS LIKE 'talname';

- IO成本
  - Data_length / 16 / 1024 = 97 页
  - 97 * 1.0 + 1.1 = 98.1
- CPU成本
  - Rows * 0.2 + 1.0 = 1939.6

------

### 索引的代价

- 扫描区间数量

  - 无论某个扫描区间的二级索引到底占用了多少页面，查询优化器认为一个扫描区间的I/O成本与读取一个页面的I/O成本相同
- 需要回表的记录数

  - 查询优化器需要计算二级索引的某个扫描区间到底包含多少条记录
  - 先找到最左记录然后找到最右记录，统计记录条数，回表的代价等于读入一个页
- 如果limit大于200，是基于统计信息计算