# 目标文件分析

### 目标文件的格式

```
1. 可重定位文件，Linux的.o文件
2. 可执行文件
3. 共享目标文件，Linux的.so
4. 核心转储文件，Linux下的core dump
```

通过file命令可以查看文件格式。

从结构上讲，目标文件已经是可执行文件的格式，只是没有经过链接，地址没有调整。

Windows下的PE和Linux的ELF都是COFF(Common file format)格式的变种。动态链接库（Linux下的.so以及Windows下的.ddl）以及静态链接库（Linux下的.a以及Windows下的.lib）都按照可执行文件格式存储。静态链接库是把很多目标文件捆绑在一起形成的文件，加上了一些索引，可以简单理解为包含很多目标文件的文件包。

------

### 目标文件内容

```
1. 编译后的机器指令代码、数据
2. 包括链接时所需要的符号表、调试信息，目标文件按照不同属性以节(section)或段(segment)的形式存储
3. 编译后的机器指令放在代码段(.code或.text)
4. 全局变量和局部变量放在数据段(.data)，未初始化的放在的.bss段
5. ELF文件的开头时一个文件头，它描述了文件属性，包括入口地址、硬件操作系统信息等
6. 文件头还包括一个段表(Section table)的偏移地址
```

因为未初始化的全局变量和局部变量默认值都是0，所以存在在.data里面没有必要。

程序运行的时候需要占用内存空间，并且可执行文件必须记录所有未初始化的全局变量以及静态变量的大小总和，记为bss段

bss段只是为未初始化的全局变量和静态变量预留位置，并没有内容，所以在文件中不占位置。

------

